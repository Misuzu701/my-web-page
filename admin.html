<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>顧客情報管理</title>
    <style>
        .customer-details, .customer-add, .customer-edit {
            display: none;
        }
        .customer-list {
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 10px;
        }

        /* 顧客情報リストのスタイル */
        .customer-item {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
            transition: background-color 0.3s ease;
        }

        .customer-item:hover {
            background-color: #e6e6e6;
        }

        .customer-item p {
            margin: 5px 0;
        }

        /* 詳細ボタンのスタイル */
        .customer-item button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .customer-item button:hover {
            background-color: #45a049;
        }

        /* 顧客詳細情報のレイアウト */
        .customer-info {
            font-size: 16px;
            margin: 15px 0;
        }

        .customer-info div {
            margin-bottom: 10px;
        }

        .customer-info strong {
            color: #333;
        }

        /* 検索フォームのスタイル */
        #searchInput {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            margin-bottom: 20px;
            border: 2px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        /* 新規顧客追加ボタン */
        #addCustomerButton {
            padding: 15px 30px;
            background-color: #007bff;
            color: white;
            font-size: 18px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: block;
            margin-bottom: 20px;
        }

        #addCustomerButton:hover {
            background-color: #0056b3;
        }

    </style>
</head>
<body>

    <h1>顧客情報管理</h1>

    <!-- 顧客情報一覧 -->
    <div id="customerList" class="customer-list">
        <h2>顧客情報一覧</h2>

        <!-- 検索フォーム -->
        <div>
            <input type="text" id="searchInput" placeholder="名前で検索" oninput="searchCustomers()">
        </div>

        <button onclick="showAddCustomerPage()">新規顧客追加</button>
        <div id="customerItems"></div>
    </div>

    <!-- 新規顧客情報追加ページ -->
    <div id="customerAddPage" class="customer-add">
        <h2>新規顧客追加</h2>
        <!-- 新規顧客のフォーム -->
        <div class="form-group">
            <label for="newMemberId">会員番号:</label>
            <input type="text" id="newMemberId" placeholder="会員番号">
        </div>
        <div class="form-group">
            <label for="newName">名前:</label>
            <input type="text" id="newName" placeholder="名前">
        </div>
        <div class="form-group">
            <label for="newOccupation">職業:</label>
            <input type="text" id="newOccupation" placeholder="職業">
        </div>
        <div class="form-group">
            <label for="newAge">年齢:</label>
            <input type="number" id="newAge" placeholder="年齢">
        </div>
        <div class="form-group">
            <label for="newNickname">あだ名:</label>
            <input type="text" id="newNickname" placeholder="あだ名">
        </div>
        <div class="form-group">
            <label for="newNGWords">NGワード:</label>
            <input type="text" id="newNGWords" placeholder="NGワード">
        </div>
        <div class="form-group">
            <label for="newPreferences">好み（話題など）:</label>
            <input type="text" id="newPreferences" placeholder="好み（話題など）">
        </div>
        <div class="form-group">
            <label for="newAlcohol">好むお酒の種類:</label>
            <select id="newAlcohol" multiple>
                <option value="ビール">ビール</option>
                <option value="ワイン">ワイン</option>
                <option value="ウィスキー">ウィスキー</option>
            </select>
        </div>
        <div class="form-group">
            <label for="newVisitDates">来店日時:</label>
            <input type="date" id="newVisitDates" multiple>
            <button onclick="addVisitDate()">来店日時追加</button>
            <ul id="visitDatesList"></ul>
        </div>
        <div class="form-group">
            <label for="newPhoto">顔写真URL:</label>
            <input type="text" id="newPhoto" placeholder="顔写真URL">
        </div>
        <div class="form-group">
            <label for="newReferral">何経由できたか:</label>
            <select id="newReferral">
                <option value="友達">友達</option>
                <option value="ふらっと">ふらっと</option>
                <option value="紹介">紹介</option>
                <option value="その他">その他</option>
            </select>
        </div>
        <div class="form-group">
            <label for="newSpent">1回でいくら使うか:</label>
            <input type="number" id="newSpent" placeholder="1回でいくら使うか">
        </div>
        <div class="form-group">
            <label for="newAfter">アフターの有無:</label>
            <select id="newAfter">
                <option value="あり">あり</option>
                <option value="なし">なし</option>
            </select>
        </div>
        <div class="form-group">
            <label for="newPreferredWomen">好みの女性:</label>
            <input type="text" id="newPreferredWomen" placeholder="好みの女性">
        </div>
        <button onclick="addNewCustomer()">顧客を追加</button>
        <button onclick="goBackToCustomerList()">戻る</button>
    </div>

    <!-- 顧客詳細情報ページ -->
    <div id="customerDetailPage" class="customer-details">
        <h2>顧客詳細情報</h2>
        <div id="customerInfo"></div>
        <button onclick="showCustomerList()">戻る</button>
        <button onclick="showEditCustomerPage()">編集</button>
    </div>

    <!-- 顧客情報編集ページ -->
    <div id="customerEditPage" class="customer-edit">
        <h2>顧客情報編集</h2>
        <div class="form-group">
            <label for="editMemberId">会員番号:</label>
            <input type="text" id="editMemberId" readonly>
        </div>
        <div class="form-group">
            <label for="editName">名前:</label>
            <input type="text" id="editName">
        </div>
        <div class="form-group">
            <label for="editOccupation">職業:</label>
            <input type="text" id="editOccupation">
        </div>
        <div class="form-group">
            <label for="editAge">年齢:</label>
            <input type="number" id="editAge">
        </div>
        <div class="form-group">
            <label for="editNickname">あだ名:</label>
            <input type="text" id="editNickname">
        </div>
        <div class="form-group">
            <label for="editNGWords">NGワード:</label>
            <input type="text" id="editNGWords">
        </div>
        <div class="form-group">
            <label for="editPreferences">好み（話題など）:</label>
            <input type="text" id="editPreferences">
        </div>
        <div class="form-group">
            <label for="editAlcohol">好むお酒の種類:</label>
            <select id="editAlcohol" multiple>
                <option value="ビール">ビール</option>
                <option value="ワイン">ワイン</option>
                <option value="ウィスキー">ウィスキー</option>
            </select>
        </div>
        <div class="form-group">
            <label for="editVisitDates">来店日時:</label>
            <input type="date" id="editVisitDates" multiple>
            <button onclick="addVisitDate()">来店日時追加</button>
            <ul id="visitDatesList"></ul>
        </div>
        <div class="form-group">
            <label for="editPhoto">顔写真URL:</label>
            <input type="text" id="editPhoto">
        </div>
        <div class="form-group">
            <label for="editReferral">何経由できたか:</label>
            <select id="editReferral">
                <option value="友達">友達</option>
                <option value="ふらっと">ふらっと</option>
                <option value="紹介">紹介</option>
                <option value="その他">その他</option>
            </select>
        </div>
        <div class="form-group">
            <label for="editSpent">1回でいくら使うか:</label>
            <input type="number" id="editSpent">
        </div>
        <div class="form-group">
            <label for="editAfter">アフターの有無:</label>
            <select id="editAfter">
                <option value="あり">あり</option>
                <option value="なし">なし</option>
            </select>
        </div>
        <div class="form-group">
            <label for="editPreferredWomen">好みの女性:</label>
            <input type="text" id="editPreferredWomen">
        </div>

        <button onclick="saveCustomerEdit()">保存</button>
        <button onclick="showCustomerList()">戻る</button>
    </div>

    <script>
        const customers = JSON.parse(localStorage.getItem('customers')) || [];
        let editingCustomerId = null;

       // 顧客情報の一覧を表示
function displayCustomerList(filteredCustomers = customers) {
    const customerItemsDiv = document.getElementById('customerItems');
    customerItemsDiv.innerHTML = '';

    filteredCustomers.forEach(customer => {
        const customerItemDiv = document.createElement('div');
        customerItemDiv.classList.add('customer-item');
        const visitCount = customer.visitDates ? customer.visitDates.length : 0;
        const points = visitCount * 10; // 来店回数でポイントを計算（1回で10ポイント）
        customerItemDiv.innerHTML = `
            <p>名前: ${customer.name}</p>
            <p>職業: ${customer.occupation}</p>
            <p>年齢: ${customer.age}</p>
            <p>来店回数: ${visitCount}回 | ポイント: ${points}p</p>
            <button onclick="viewCustomerDetails('${customer.memberId}')">詳細</button>
        `;
        customerItemsDiv.appendChild(customerItemDiv);
    });
}


        // 顧客詳細情報を表示
        function viewCustomerDetails(memberId) {
    const customer = customers.find(c => c.memberId === memberId);
    if (!customer) {
        alert('顧客情報が見つかりません');
        return;
    }

    editingCustomerId = customer.memberId;

    const customerInfoDiv = document.getElementById('customerInfo');
    customerInfoDiv.innerHTML = `
        <div><strong>会員番号:</strong> ${customer.memberId}</div>
        <div><strong>名前:</strong> ${customer.name}</div>
        <div><strong>職業:</strong> ${customer.occupation}</div>
        <div><strong>年齢:</strong> ${customer.age}</div>
        <div><strong>あだ名:</strong> ${customer.nickname}</div>
        <div><strong>来店回数:</strong> ${customer.visitDates.length}回</div>
        <div><strong>来店日時:</strong> ${customer.visitDates.join(', ')}</div>
        <div><strong>NGワード:</strong> ${customer.ngWords}</div>
        <div><strong>好み（話題など）:</strong> ${customer.preferences}</div>
        <div><strong>好むお酒の種類:</strong> ${customer.alcohol.join(', ')}</div>
        <div><strong>顔写真:</strong> <img src="${customer.photo}" alt="顔写真"></div>
        <div><strong>何経由できたか:</strong> ${customer.referral}</div>
        <div><strong>1回でいくら使うか:</strong> ${customer.spent}</div>
        <div><strong>アフターの有無:</strong> ${customer.after}</div>
        <div><strong>好みの女性:</strong> ${customer.preferredWomen}</div>
    `;
    document.getElementById('customerList').style.display = 'none';
    document.getElementById('customerDetailPage').style.display = 'block';
}


// 新規顧客追加ページを表示する関数
function showAddCustomerPage() {
    document.getElementById('customerList').style.display = 'none';
    document.getElementById('customerAddPage').style.display = 'block';
}


        // 編集ページに移動
        function showEditCustomerPage() {
            const customer = customers.find(c => c.memberId === editingCustomerId);
            if (!customer) {
                alert('顧客情報が見つかりません');
                return;
            }

            document.getElementById('editMemberId').value = customer.memberId;
            document.getElementById('editName').value = customer.name;
            document.getElementById('editOccupation').value = customer.occupation;
            document.getElementById('editAge').value = customer.age;
            document.getElementById('editNickname').value = customer.nickname;
            document.getElementById('editNGWords').value = customer.ngWords;
            document.getElementById('editPreferences').value = customer.preferences;
            document.getElementById('editAlcohol').value = customer.alcohol;
            document.getElementById('editVisitDates').value = customer.visitDates.join(',');
            document.getElementById('editPhoto').value = customer.photo;
            document.getElementById('editReferral').value = customer.referral;
            document.getElementById('editSpent').value = customer.spent;
            document.getElementById('editAfter').value = customer.after;
            document.getElementById('editPreferredWomen').value = customer.preferredWomen;

            document.getElementById('customerDetailPage').style.display = 'none';
            document.getElementById('customerEditPage').style.display = 'block';
        }

        // 顧客編集内容を保存
        function saveCustomerEdit() {
            const customer = customers.find(c => c.memberId === editingCustomerId);
            if (!customer) {
                alert('顧客情報が見つかりません');
                return;
            }

            customer.name = document.getElementById('editName').value;
            customer.occupation = document.getElementById('editOccupation').value;
            customer.age = document.getElementById('editAge').value;
            customer.nickname = document.getElementById('editNickname').value;
            customer.ngWords = document.getElementById('editNGWords').value;
            customer.preferences = document.getElementById('editPreferences').value;
            customer.alcohol = Array.from(document.getElementById('editAlcohol').selectedOptions).map(option => option.value);
            customer.visitDates = document.getElementById('editVisitDates').value.split(',');
            customer.photo = document.getElementById('editPhoto').value;
            customer.referral = document.getElementById('editReferral').value;
            customer.spent = document.getElementById('editSpent').value;
            customer.after = document.getElementById('editAfter').value;
            customer.preferredWomen = document.getElementById('editPreferredWomen').value;

            localStorage.setItem('customers', JSON.stringify(customers));
            showCustomerList();
        }

        // 顧客検索機能（名前で検索）
function searchCustomers() {
    const searchInput = document.getElementById('searchInput').value.toLowerCase();
    const filteredCustomers = customers.filter(customer => {
        return customer.name.toLowerCase().includes(searchInput);
    });

    // フィルタリングした顧客リストを表示
    displayCustomerList(filteredCustomers);
}


        // 顧客リストページに戻る
        function showCustomerList() {
            document.getElementById('customerList').style.display = 'block';
            document.getElementById('customerDetailPage').style.display = 'none';
            document.getElementById('customerEditPage').style.display = 'none';
        }

        // 新規顧客追加
        function addNewCustomer() {
            const newCustomer = {
                memberId: document.getElementById('newMemberId').value,
                name: document.getElementById('newName').value,
                occupation: document.getElementById('newOccupation').value,
                age: document.getElementById('newAge').value,
                nickname: document.getElementById('newNickname').value,
                ngWords: document.getElementById('newNGWords').value,
                preferences: document.getElementById('newPreferences').value,
                alcohol: Array.from(document.getElementById('newAlcohol').selectedOptions).map(option => option.value),
                visitDates: [],
                photo: document.getElementById('newPhoto').value,
                referral: document.getElementById('newReferral').value,
                spent: document.getElementById('newSpent').value,
                after: document.getElementById('newAfter').value,
                preferredWomen: document.getElementById('newPreferredWomen').value
            };

            customers.push(newCustomer);
            localStorage.setItem('customers', JSON.stringify(customers));
            showCustomerList();
        }

        // 新規顧客追加ページに戻る
        function goBackToCustomerList() {
            document.getElementById('customerAddPage').style.display = 'none';
            document.getElementById('customerList').style.display = 'block';
        }

        // 初期表示
        displayCustomerList();
    </script>

</body>
</html>
